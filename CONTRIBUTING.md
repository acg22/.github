# How to Build The Project

1. [Install Node.js](https://nodejs.org/en/download/)
2. ```shell
   corepack enable
   corepack prepare yarn@4.0.0-rc.30 --activate  # This command installs yarn@4 globally. If you don't like that, use `corepack yarn` instead of `yarn` in later commands.
   yarn

   yarn start
   # or
   yarn build
   python3 -m http.server --bind localhost --directory dist
   ```

# Development Environment
I highly recommend using VSCode with the extensions listed in `.vscode/extensions.json` for development.
- `"boyswan.glsl-literal"` highlights the `/* glsl */` syntax in `.frag.ts` and `.vert.ts` files.
- `"bradlc.vscode-tailwindcss"` adds auto-completions and hovers to tailwind classes.
- `"ms-vscode.vscode-typescript-next"` allows us to use the `satisfies` syntax in TypeScript 4.9 before its release.

# Directory Structure
| Path | Purpose |
|-|-|
| public/ | The directory to put static assets. [Vite copies files in the `public/` directory to the root directory.](https://vitejs.dev/guide/assets.html#the-public-directory) |
| public/audio | sound effects and bgms |
| public/font | fonts |
| public/models | 3D models. You can add 3D models you found in the Internet but: 1. make sure to update the `credit.html`, 2. do not use models with ND license, 3. the models should be <5MB (3MB â‰ˆ 1s to download). You can use this link: [sketchfab](https://sketchfab.com/search?features=downloadable&licenses=322a749bcfa841b29dff1e8a1bb74b0b&licenses=7c23a1ba438d4306920229c12afcb5f9&licenses=b9ddc40b93e34cdca1fc152f39b9f375&type=models) to search 3D models. |
| public/[audio,font,models]/credit.html | manually-updated list of the attribution of each file |
| public/lib_credit.html | the auto-generated list of third-party libraries |
| public/lib_credit2.html | the list of third-party libraries that are missing from lib_credit.html |
| src/main.ts | The entry point and the main game/render loop |
| src/debug.tsx | exports debugging components that should be removed in production builds. |
| src/saveData.ts | exports the centralized store of the game state. |
| src/hooks.ts | Defines events to be listened by various other modules. See [Main Game Loop](/docs/Main%20Game%20Loop.md) to find when these events are fired. |
| src/dom/index.tsx | The entry point of the renderer of the UI. See also: [Cross-Browser Support](/docs/Cross-Browser%20Support.md). |
| src/dom/ | Preact components |
| src/webgl/ | The directory to put modules related to webgl/Three.js. `index.ts` is auto-generated by looking up `export [default,const,class]` in `src/webgl/*.ts`. See also: [Using Shaders through Three.js](/docs/Using%20Shaders%20through%20Three.js.md)|
| src/weapons/ |  |
| src/stages/[id]_[name].ts | The definition of stages. The filenames are parsed by a program to generate src/stages/index.ts. |
| src/constants.ts | defines constants you can tweak to balance the game, flavor text, etc. |
| codegen.js | This is the file that updates `src/[weapons,stages,webgl]/index.ts`, and it is run every time before building the project. |

# Cheating
The store in `saveData.ts` is set to a property of `window` so that you can modify its value from the [dev tools](https://developer.chrome.com/docs/devtools/open/) console.

```typescript
store.getState().addMoney(10000)
```

# Game Design
If you want to make changes to the game system, read this first: [Game Design](/docs/Game%20Design.md)
